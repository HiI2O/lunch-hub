---
description: テスト駆動開発ワークフローを強制。インターフェースをスキャフォールドし、最初にテストを生成し、その後パスするための最小限のコードを実装。80%以上のカバレッジを確保。
---

# TDDコマンド

このコマンドは **tdd-guide** エージェントを呼び出して、テスト駆動開発の方法論を強制します。

## このコマンドの機能

1. **インターフェースをスキャフォールド** - まず型/インターフェースを定義
2. **最初にテストを生成** - 失敗するテストを書く（RED）
3. **最小限のコードを実装** - パスするのに十分なコードだけを書く（GREEN）
4. **リファクタリング** - テストをグリーンに保ちながらコードを改善（REFACTOR）
5. **カバレッジを確認** - 80%以上のテストカバレッジを確保

## 使用タイミング

以下の場合に `/tdd` を使用:
- 新機能の実装
- 新しい関数/コンポーネントの追加
- バグ修正（まずバグを再現するテストを書く）
- 既存コードのリファクタリング
- 重要なビジネスロジックの構築

## 動作方法

tdd-guideエージェントは以下を行います：

1. 入出力用の**インターフェースを定義**
2. **失敗するテストを書く**（コードがまだ存在しないため）
3. **テストを実行**して正しい理由で失敗することを確認
4. テストをパスさせる**最小限の実装を書く**
5. **テストを実行**してパスすることを確認
6. テストをグリーンに保ちながら**コードをリファクタリング**
7. **カバレッジをチェック**して80%未満ならテストを追加

## TDDサイクル

```
RED → GREEN → REFACTOR → REPEAT

RED:      失敗するテストを書く
GREEN:    パスするための最小限のコードを書く
REFACTOR: コードを改善し、テストがパスし続けることを確認
REPEAT:   次の機能/シナリオ
```

## 使用例

```
ユーザー: /tdd マーケットの流動性スコアを計算する関数が必要

エージェント (tdd-guide):
# TDDセッション: マーケット流動性スコア計算

## ステップ1: インターフェースを定義（SCAFFOLD）

```typescript
// lib/liquidity.ts
export interface MarketData {
  totalVolume: number
  bidAskSpread: number
  activeTraders: number
  lastTradeTime: Date
}

export function calculateLiquidityScore(market: MarketData): number {
  // TODO: 実装
  throw new Error('Not implemented')
}
```

## ステップ2: 失敗するテストを書く（RED）

// ...テストコード...

## ステップ3: テストを実行 - 失敗を確認

✅ 期待通りテストが失敗。実装の準備完了。

## ステップ4: 最小限のコードを実装（GREEN）

// ...実装コード...

## ステップ5: テストを実行 - パスを確認

✅ すべてのテストがパス！

## ステップ6: リファクタリング（IMPROVE）

// ...リファクタリングされたコード...

## ステップ7: テストがまだパスすることを確認

✅ リファクタリング完了、テストはまだパス！

## ステップ8: カバレッジをチェック

カバレッジ: 100% ✅ (目標: 80%)

✅ TDDセッション完了！
```

## TDDベストプラクティス

**すべきこと:**
- ✅ 実装の前に最初にテストを書く
- ✅ テストを実行して実装前に失敗することを確認
- ✅ テストをパスさせる最小限のコードを書く
- ✅ テストがグリーンになってからのみリファクタリング
- ✅ エッジケースとエラーシナリオを追加
- ✅ 80%以上のカバレッジを目指す（重要なコードは100%）

**すべきでないこと:**
- ❌ テストの前に実装を書く
- ❌ 各変更後のテスト実行をスキップ
- ❌ 一度に多くのコードを書く
- ❌ 失敗するテストを無視
- ❌ 実装詳細をテスト（動作をテスト）
- ❌ すべてをモック（インテグレーションテストを優先）

## 含めるべきテストタイプ

**ユニットテスト**（関数レベル）:
- ハッピーパスシナリオ
- エッジケース（空、null、最大値）
- エラー条件
- 境界値

**インテグレーションテスト**（コンポーネントレベル）:
- APIエンドポイント
- データベース操作
- 外部サービス呼び出し
- フック付きReactコンポーネント

**E2Eテスト**（`/e2e` コマンドを使用）:
- 重要なユーザーフロー
- 複数ステップのプロセス
- フルスタック統合

## カバレッジ要件

- **最低80%** すべてのコード
- **100%必須** 以下について:
  - 金融計算
  - 認証ロジック
  - セキュリティクリティカルなコード
  - コアビジネスロジック

## 重要な注意事項

**必須**: テストは実装の前に書かなければならない。TDDサイクルは:

1. **RED** - 失敗するテストを書く
2. **GREEN** - パスするように実装
3. **REFACTOR** - コードを改善

REDフェーズをスキップしない。テストの前にコードを書かない。

## 他のコマンドとの統合

- 何を構築するか理解するために最初に `/plan` を使用
- テストと共に実装するために `/tdd` を使用
- ビルドエラーが発生した場合は `/build-and-fix` を使用
- 実装をレビューするために `/code-review` を使用
- カバレッジを確認するために `/test-coverage` を使用

## 関連エージェント

このコマンドは以下にある `tdd-guide` エージェントを呼び出します：
`~/.claude/agents/tdd-guide.md`
